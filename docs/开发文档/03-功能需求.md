# Mini-Todo - 功能需求规格

## 1. 待办事项管理

### 1.1 待办基本操作

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 创建待办 | 创建新的待办事项 | P0 |
| 编辑待办 | 修改待办标题、描述等信息 | P0 |
| 删除待办 | 删除指定待办事项 | P0 |
| 完成待办 | 标记待办为已完成状态 | P0 |
| 取消完成 | 将已完成待办恢复为未完成 | P0 |

### 1.2 待办属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| id | number | 自动 | 唯一标识符 |
| title | string | 是 | 待办标题 |
| description | string | 否 | 待办详细描述 |
| priority | enum | 是 | 优先级：high/medium/low |
| notify_at | datetime | 否 | 通知提醒时间 |
| notify_before | number | 否 | 提前通知分钟数 |
| completed | boolean | 是 | 是否已完成 |
| sort_order | number | 是 | 排序权重 |
| created_at | datetime | 自动 | 创建时间 |
| updated_at | datetime | 自动 | 更新时间 |

### 1.3 子任务功能

| 功能 | 描述 |
|------|------|
| 添加子任务 | 在待办下添加子任务 |
| 编辑子任务 | 修改子任务标题 |
| 删除子任务 | 删除指定子任务 |
| 完成子任务 | 标记子任务为已完成 |
| 子任务数量 | 显示已完成/总数 (如 2/5) |

**子任务属性**：
- id: 唯一标识符
- parent_id: 父待办 ID
- title: 子任务标题
- completed: 是否已完成
- sort_order: 排序权重

### 1.4 优先级设置

| 级别 | 标识 | 颜色 | 描述 |
|------|------|------|------|
| 高 | high | #EF4444 (红色) | 紧急重要任务 |
| 中 | medium | #F59E0B (橙色) | 一般重要任务 |
| 低 | low | #10B981 (绿色) | 不紧急任务 |

### 1.5 拖拽排序

- 支持拖拽待办项改变顺序
- 拖拽时显示视觉反馈
- 放下后自动保存新顺序
- 子任务也支持拖拽排序

## 2. 通知提醒系统

### 2.1 通知设置

| 选项 | 描述 |
|------|------|
| 提前 5 分钟 | 在设定时间前 5 分钟通知 |
| 提前 15 分钟 | 在设定时间前 15 分钟通知 |
| 提前 30 分钟 | 在设定时间前 30 分钟通知 |
| 自定义时间 | 用户输入自定义提前分钟数 |
| 准时通知 | 在设定时间准时通知 |

### 2.2 通知行为

- 使用 Windows 系统通知
- 通知标题：待办事项标题
- 通知内容：待办描述（如有）
- 点击通知打开应用
- 已完成的待办不再通知

### 2.3 后台检查

- 应用启动时开始定时检查
- 每分钟检查一次待通知的待办
- 已发送通知的待办标记为已通知

## 3. 窗口特殊功能

### 3.1 普通模式

| 特性 | 描述 |
|------|------|
| 主题 | 浅色主题 |
| 背景 | 白色不透明背景 |
| 拖拽 | 可拖拽移动窗口 |
| 标题栏 | 自定义标题栏，包含最小化/关闭按钮 |
| Win+D | 正常响应显示桌面 |

### 3.2 固定模式

| 特性 | 描述 |
|------|------|
| 背景 | 透明背景，半透明内容区域 |
| 位置 | 固定在用户最后拖拽的位置 |
| 拖拽 | 禁用拖拽移动 |
| 关闭 | 禁用关闭按钮 |
| 最小化 | 禁用最小化 |
| Win+D | 忽略显示桌面命令，保持显示 |
| 置顶 | 窗口始终置顶 |

### 3.3 模式切换

- 通过标题栏按钮切换模式
- 切换到固定模式时：
  1. 记录当前窗口位置
  2. 设置透明背景
  3. 禁用相关功能
  4. 设置窗口置顶
- 切换到普通模式时：
  1. 恢复不透明背景
  2. 启用所有功能
  3. 取消窗口置顶

## 4. 数据管理

### 4.1 数据存储

- 使用 SQLite 数据库
- 数据文件位置：`%APPDATA%/mini-todo/data.db`
- 自动创建数据库和表结构

### 4.2 数据导出

- 导出格式：JSON
- 导出内容：所有待办及子任务
- 导出文件命名：`mini-todo-backup-YYYYMMDD-HHMMSS.json`
- 支持选择保存位置

### 4.3 数据导入

- 导入格式：JSON
- 导入前确认对话框
- 支持合并导入或覆盖导入
- 导入验证：检查数据格式有效性

### 4.4 导出数据格式

```json
{
  "version": "1.0",
  "exported_at": "2026-01-28T12:00:00Z",
  "todos": [
    {
      "id": 1,
      "title": "待办标题",
      "description": "待办描述",
      "priority": "high",
      "notify_at": "2026-01-29T09:00:00Z",
      "notify_before": 15,
      "completed": false,
      "sort_order": 1,
      "created_at": "2026-01-28T10:00:00Z",
      "updated_at": "2026-01-28T10:00:00Z",
      "subtasks": [
        {
          "id": 1,
          "title": "子任务标题",
          "completed": false,
          "sort_order": 1
        }
      ]
    }
  ]
}
```

## 5. 用户界面要求

### 5.1 主界面布局

```
┌─────────────────────────────────────┐
│  🔒固定 ⚙设置                    ─ □ ✕ │  ← 标题栏
├─────────────────────────────────────┤
│  + 添加新待办...                      │  ← 快速添加
├─────────────────────────────────────┤
│  ┌─────────────────────────────────┐ │
│  │ ● 高优先级待办标题           ⋮ │ │  ← 待办项
│  │   子任务 2/3                    │ │
│  │   🔔 今天 14:00                 │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │ ○ 中优先级待办标题           ⋮ │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │ ○ 低优先级待办标题           ⋮ │ │
│  └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│  已完成 (3)                     ▼   │  ← 已完成折叠区
└─────────────────────────────────────┘
```

### 5.2 交互要求

- 添加待办：点击快速添加区域或按快捷键
- 编辑待办：点击待办项打开编辑弹窗
- 完成待办：点击左侧复选框
- 删除待办：点击更多菜单中的删除选项
- 拖拽排序：按住拖动手柄拖拽
